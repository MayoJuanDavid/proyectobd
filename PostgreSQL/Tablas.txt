CREATE TABLE Paises(
id_pais numeric(2) primary key NOT NULL,
nombre_pais VARCHAR(15) NOT NULL
);

CREATE TABLE Clientes_Floristerias(
id_cliente numeric(4) primary key NOT NULL,
primer_nombre varchar(15) NOT NULL,
primer_apelliddo varchar(15),
documento_identidad numeric(8) unique NOT NULL,
fecha_nacimiento date NOT NULL,
segundo_nombre varchar(15)
);

CREATE TABLE Significados(
id_significado numeric (3) primary key NOT NULL,
descripcion varchar(15) NOT NULL,
tipo varchar(11) NOT NULL 

constraint CHK_tipo_significado CHECK (tipo IN ('ocasion','sentimiento'))
);

CREATE TABLE Colores_Flores(
cod_hex numeric(6) primary key NOT NULL,
nombre_color varchar(15) NOT NULL,
descripcion varchar(30) NOT NULL
);

CREATE TABLE FLORES_CORTES(
id_corte numeric(5) primary key NOT NULL,
nombre_comun varchar(10) NOT NULL, 
etimologia varchar(15) NOT NULL, 
genero_especie varchar(15) NOT NULL,
colores varchar(20) NOT NULL, 
temperatura numeric(3) NOT NULL
);

CREATE TABLE Productores(
id_productor numeric(3) primary key NOT NULL,
nombre_productor VARCHAR(15) NOT NULL,
sitio_web VARCHAR(20) NOT NULL,
email VARCHAR(20) NOT NULL,
id_pais numeric(2) NOT NULL,
constraint FK_pais foreign key(id_pais) references Paises(id_pais)
);

CREATE TABLE Subastadoras(
id_subastadora numeric(3) primary key NOT NULL,
nombre_subastadora VARCHAR(15) NOT NULL,
id_pais numeric(2) NOT NULL,
constraint FK_pais foreign key(id_pais) references Paises(id_pais)
);

CREATE TABLE Contratos(
id_productor numeric(3) NOT NULL,
id_subastadora numeric(3) NOT NULL,
id_contrato numeric(4) NOT NULL,
porcentaje_produccion_total numeric(2) NOT NULL,
clasificacion varchar(2) NOT NULL,
fecha_firma date NOT NULL,
id_productor_ren numeric(3) NOT NULL, 
id_subastadora_ren numeric(3) NOT NULL,
id_renovacion numeric(4),


constraint PK_Contratos primary key(id_productor, id_subastadora, id_contrato),
constraint FK_productor foreign key(id_productor) references Productores(id_productor),
constraint FK_subastadora foreign key(id_subastadora) references Subastadoras(id_subastadora),
constraint CHK_clasificacion check(clasificacion IN ('CA','CB','CC','CG','KA')),
constraint FK_Renovacion foreign key(id_productor_ren, id_subastadora_ren,id_renovacion) references Contratos(id_productor, id_subastadora,id_contrato),
constraint UNIQUE_RENOVACION unique(id_productor_ren, id_subastadora_ren,id_renovacion)

);

CREATE TABLE PAGO_MULTA(
id_productor numeric(3) NOT NULL,
id_subastadora numeric(3) NOT NULL,
id_contrato numeric(4) NOT NULL,
id_comision numeric(2) NOT NULL,
monto numeric(3) NOT NULL,
tipo varchar(9) NOT NULL, 
fecha_pago date NOT NULL,
constraint PK_Comision_Venta primary key(id_productor, id_subastadora, id_contrato, id_comision),
constraint FK_CONTRATO foreign key(id_productor, id_subastadora, id_contrato) references Contratos(id_productor, id_subastadora, id_contrato)
);

CREATE TABLE Catalogos_Productores(
id_productor numeric(3) NOT NULL,
cod_VBN numeric(8) NOT NULL,
nombre VARCHAR(15) NOT NULL,
descripcion varchar(25),
cantidad numeric(3) NOT NULL,
longitud numeric(2),

constraint PK_Catalago_productor primary key(id_productor, cod_VBN),
constraint FK_productor foreign key(id_productor) references Productores(id_productor)
);


CREATE TABLE DETALLES_CONTRATOS(
id_productor numeric(3) NOT NULL,
id_subastadora numeric(3) NOT NULL,
id_contrato numeric(4) NOT NULL,
cod_vbn numeric(8) NOT NULL,
constraint PK_Catalogo primary key(id_productor,id_subastadora,id_contrato,cod_VBN),

constraint FK_Contrato foreign key(id_productor,id_subastadora,id_contrato) references Contratos(id_productor,id_subastadora,id_contrato),
constraint FK_Catalogo foreign key(id_productor,cod_VBN) references Catalogos_Productores(id_productor, cod_VBN)
);

CREATE TABLE Floristerias(
id_pais numeric(3) NOT NULL,
id_floristeria numeric(3) NOT NULL,
nombre_comprador VARCHAR(15) NOT NULL,
email VARCHAR(20) NOT NULL,
constraint PK_floristeria primary key(id_floristeria),
constraint FK_pais foreign key(id_pais) references Paises(id_pais)
);

CREATE TABLE Personales(
id_floristeria numeric(3) NOT NULL,
id_personal numeric (5) NOT NULL,
primer_nombre varchar(15) NOT NULL,
primer_apellido varchar(15) NOT NULL,
documento_identidad numeric(8) unique NOT NULL,
fecha_nacimiento date NOT NULL,
segundo_nombre varchar(15),
constraint PK_Personales primary key(id_floristeria,id_personal),
constraint FK_Comprador foreign key(id_floristeria) references Floristerias(id_floristeria)
);

CREATE TABLE Afiliaciones(
id_floristeria numeric(3) NOT NULL,
id_subastadora numeric(3) NOT NULL,
constraint PK_Afiliacion primary key(id_floristeria,id_subastadora),
constraint FK_Comprador foreign key(id_floristeria) references Floristerias(id_floristeria),
constraint FK_Subastadora foreign key(id_subastadora) references Subastadoras(id_subastadora)
);

CREATE TABLE Facturas_Compras(
id_factura numeric(4) primary key NOT NULL, 
fecha_emision date NOT NULL,
montol_total numeric(4) NOT NULL,
envio varchar(2) NOT NULL,
id_floristeria numeric(3) NOT NULL,
id_subastadora numeric(3) NOT NULL,

constraint FK_Afiliacion foreign key(id_floristeria, id_subastadora) references Afiliaciones(id_floristeria, id_subastadora)
);

CREATE TABLE Lotes(
id_productor numeric(3) NOT NULL,
id_subastadora numeric(3) NOT NULL,
id_contrato numeric(4) NOT NULL,
cod_vbn numeric(8) NOT NULL,
id_factura numeric(4) NOT NULL,
id_lote numeric(4) NOT NULL, 
cantidad numeric(4) NOT NULL, 
precio_inicial date NOT NULL, 
indice_calidad numeric(1) NOT NULL, 
precio_final date NOT NULL, 


constraint PK_Lotes primary key(id_productor, id_subastadora, id_contrato, cod_VBN, id_factura, id_lote),
constraint FK_Detalle_Contrato foreign key(id_productor, id_subastadora, id_contrato, cod_VBN) references DETALLES_CONTRATOS(id_productor, id_subastadora, id_contrato, cod_VBN),
constraint FK_FACTURA_Compra foreign key(id_factura) references Facturas_Compras(id_factura)
);

CREATE TABLE Enlaces(
id_significado numeric(3) NOT NULL, 
id_enlace numeric(3) NOT NULL,
descripcion varchar(30) NOT NULL, 
id_corte numeric(5), 
cod_hex numeric(6),
 
constraint PK_enlace primary key(id_significado, id_enlace),
constraint FK_Flor_Corte foreign key(id_corte) references FLORES_CORTES(id_corte),
constraint FK_Significado foreign key(id_significado) references Significados(id_significado),
constraint FK_Color foreign key(cod_hex) references COLORES_FLORES(cod_hex)
);

CREATE TABLE CATALOGOS_FLORISTERIAS(
id_floristeria numeric(3) NOT NULL,
codigo numeric(4) NOT NULL, 
nombre varchar(15) NOT NULL,
descripcion varchar(30),
id_corte numeric(5) NOT NULL,
cod_hex numeric(6) NOT NULL,

constraint PK_Cat_flor primary key(id_floristeria, codigo),
constraint FK_Floristeria foreign key(id_floristeria) references Floristerias(id_floristeria),
constraint FK_Flor_Corte foreign key(id_corte) references FLORES_CORTES(id_corte),
constraint FK_Color foreign key(cod_hex) references COLORES_FLORES(cod_hex)

);

CREATE TABLE HIST_PRECIO_UNITARIO(
id_floristeria numeric(3) NOT NULL,
codigo numeric(4) NOT NULL, 
fecha_i date NOT NULL, 
fecha_f date,
precio_unidad numeric(3) NOT NULL, 
tamaño_tallo numeric(2),

constraint PK_Hist_Precio primary key(id_floristeria, codigo, fecha_i),
constraint FK_Catalogo_Flor foreign key(id_floristeria, codigo) references CATALOGOS_FLORISTERIAS(id_floristeria, codigo)
);


CREATE TABLE DET_BOUQUET(
id_floristeria numeric(3) NOT NULL,
codigo numeric(4) NOT NULL, 
id_bouquet numeric(4) NOT NULL, 
cantidad numeric(2) NOT NULL, 
descripcion varchar(30),
tallo_tamaño numeric(2),

constraint PK_Bouquet primary key(id_floristeria, codigo, id_bouquet),
constraint FK_Catalogo_Flor foreign key(id_floristeria, codigo) references CATALOGOS_FLORISTERIAS(id_floristeria, codigo)
);

CREATE TABLE Facturas_Ventas(
id_floristeria numeric(3) NOT NULL,
numero numeric(4) NOT NULL, 
fecha date NOT NULL, 
total numeric(4) NOT NULL, 

constraint PK_Factura_venta primary key(id_floristeria, numero),
constraint FK_Floristeria foreign key(id_floristeria) references Floristerias(id_floristeria)
);

CREATE TABLE DET_FACT_VENTAS(
id_floristeria numeric(3) NOT NULL,
numero numeric(4) NOT NULL,
id_det_fact_venta numeric(4) NOT NULL, 
cantidad numeric(3) NOT NULL, 
valor_cantidad numeric(2), 
valor_precio numeric(2), 
promedio numeric(2),
codigo numeric(4),
id_bouquet numeric(4),

constraint PK_DET_Venta primary key(id_floristeria, numero, id_det_fact_venta),
constraint FK_Fact_venta foreign key(id_floristeria, numero) references Facturas_ventas(id_floristeria, numero),
constraint Fk_Cat_Flor foreign key(id_floristeria,codigo) references Catalogos_Floristerias(id_floristeria,codigo), 
constraint FK_Bouquet foreign key(id_floristeria,codigo,id_bouquet) references Det_Bouquet(id_floristeria,codigo,id_bouquet)
);